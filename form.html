<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Send Email using Mailjet API</title>
</head>
<body>
    <h1>Send Email using Mailjet API</h1>

    <button id="sendEmailButton" onclick="sendOtp()">Send Email</button>
    <div id="otpDiv" style="display: none;">
        <input type="text" id="otpInput" placeholder="Enter OTP"><br>
        <button type="button" id="validateOTP" onclick="validateOTP()">Validate OTP</button>
    </div>
    <p id="validationError" aria-live="assertive" aria-atomic="true" role="alert" style="color: red; display: none;"></p>

    <script>
        function sendOtp() {
            const apiKey = '78a013a0125cbdb61327de831d1fdd0b';
            const apiSecret = '5c2fbbec5443429c0490705941f7c279';
            const senderEmail = 'jaysolanki060192@gmail.com';
            const recipientEmail = 'blindtechhindi@gmail.com';
            const otp = Math.floor(100000 + Math.random() * 900000);
            const subject = 'One Time Password (OTP) for Account Verification';
            const body = Your OTP is: ${otp};

            const emailData = {
                "Messages": [
                    {
                        "From": {
                            "Email": senderEmail,
                            "Name": "Your Name"
                        },
                        "To": [
                            {
                                "Email": recipientEmail,
                                "Name": "Recipient Name"
                            }
                        ],
                        "Subject": subject,
                        "TextPart": body
                    }
                ]
            };

            fetch('https://api.mailjet.com/v3.1/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': Basic ${btoa(apiKey + ':' + apiSecret)}
                },
                body: JSON.stringify(emailData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('otpDiv').style.display = 'block';
                localStorage.setItem('otp', otp);
                showMessage('OTP sent successfully!', 'green');
                console.log(JSON.stringify(data)); // stringify the response object
            })
            .catch(error => {
                showMessage('Error sending OTP. Please try again.', 'red');
                console.error(error);
            });
        }

        function validateOTP() {
            const enteredOTP = document.getElementById('otpInput').value;
            const storedOTP = localStorage.getItem('otp');

            if (enteredOTP === storedOTP) {
                localStorage.removeItem('otp');
                signUp();
            } else {
                showMessage('Invalid OTP. Please try again.', 'red');
            }
        }

        function showMessage(message, color) {
            const validationError = document.getElementById('validationError');
            validationError.innerText = message;
            validationError.style.color = color;
            validationError.style.display = 'block';
            setTimeout(function(){
                validationError.innerText = "";
                validationError.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>