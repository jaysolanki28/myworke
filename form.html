<p id="date">Selected Date: <strong id="selectedDate"></strong></p>
<strong id="message" aria-live="polite"></strong>
<button class="continue-button" id="dateButton">Select date of birth of applicant</button>
<input type="date" id="dob" aria-hidden="true" style="visibility: hidden;">
<script>
let today; // Define today in the global scope

// Function to convert month number to month name
const getMonthName = (month) => {
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    return monthNames[month];
};

// Make an API call to fetch the current date of India
fetch('http://worldtimeapi.org/api/timezone/Asia/Kolkata')
    .then(response => response.json())
    .then(data => {
        today = new Date(data.datetime);
    });

document.getElementById("dob").addEventListener('change', function() {
    let dob = this.value;
    let selectedDate = new Date(dob);

    if (!today) {
        alertMessage("Fetching current date. Please try again in a moment.");
        this.value = '';
        return;
    }

    if (selectedDate > today) {
        alertMessage("Please enter a valid date of birth (not a future date).");
        this.value = ''; // Clear the input field if a future date is selected
        return;
    }

    let age = calculateAge(dob);

    if (isNaN(age)) {
        alertMessage("Please enter a valid date of birth.");
        this.value = '';
        return;
    }

    // Formatting the selected date to (Day Month Date Year)
    const formattedDate = ${selectedDate.toLocaleString('en-us', { weekday: 'long' })} ${selectedDate.getDate()} ${getMonthName(selectedDate.getMonth())} ${selectedDate.getFullYear()};

    document.getElementById('selectedDate').textContent = formattedDate;

    let birthDate = new Date(dob);
    let months = today.getMonth() - birthDate.getMonth();
    let days = today.getDate() - birthDate.getDate();

    if (months < 0 || (months === 0 && days < 0)) {
        age--;
        months += 12;
    }
    if (days < 0) {
        months--;
        days += new Date(today.getFullYear(), today.getMonth(), 0).getDate();
    }

    let yearsLabel = age === 1 ? 'year' : 'years';
    let monthsLabel = months === 1 ? 'month' : 'months';
    let daysLabel = days === 1 ? 'day' : 'days';

    let ageMessage = `Your age is ${age} ${yearsLabel}, ${months} ${monthsLabel}, and ${days} ${daysLabel}.`;

    if (age < 16 || age > 40) {
        document.getElementById('message').innerHTML = "Sorry, only individuals aged between 16 and 40 are eligible to fill this form." + "<br>" + ageMessage;
        document.getElementById("dateButton").style.display = "none";
    } else {
        document.getElementById('message').innerHTML = "Congratulations! You are eligible to proceed." + "<br>" + ageMessage;
        document.getElementById("dateButton").style.display = "none";
    }
});

function calculateAge(dateString) {
    let birthDate = new Date(dateString);

    if (isNaN(birthDate.getTime())) {
        return NaN;
    }

    let age = today.getFullYear() - birthDate.getFullYear();

    if (today.getMonth() < birthDate.getMonth() || (today.getMonth() === birthDate.getMonth() && today.getDate() < birthDate.getDate())) {
        age--;
    }

    return age;
}

document.getElementById('dateButton').addEventListener('click', function() {
    document.getElementById('dob').click();
});
</script>